 <style>
     div.left{float: left;width: 250px !important;}
     div.right{float: left;width: 200px !important;}
     ul.ztree {margin-top: 10px;border: 1px solid #617775;background: #f0f6e4;width:220px;height:360px;overflow-y:scroll;overflow-x:auto;}
 </style>

<SCRIPT type="text/javascript">
    <!--
    var setting = {
        edit: {
            enable: true,
            showRemoveBtn: false,
            showRenameBtn: false,
            drag:{
                isCopy:true,
                isMove:false
            }
        },
        data: {
            simpleData: {
                enable: true
            }
        },
        callback: {
            beforeDrag: beforeDrag,
            beforeDrop: beforeDrop,
            onDrop:onDrop
        }
    };

    var zNodes =<%= raw @menus.to_json%>
    var adminNodes=<%= raw @admin_menus.to_json%>

    var admin_id=<%= @admin_id%>
    function beforeDrag(treeId, treeNodes) {
        for (var i=0,l=treeNodes.length; i<l; i++) {
            if (treeNodes[i].drag === false) {
                return false;
            }
        }
        return true;
    }
    function beforeDrop(treeId, treeNodes, targetNode, moveType) {
        var drag_id
        drag_id=treeNodes[0]['id'] //获取被拖拽的id
        var left_treeObj = $.fn.zTree.getZTreeObj(treeId);
        console.log(treeId)
        var nodes = left_treeObj.getNodesByParam("id", drag_id, null);    //查找用户是否已经存在此菜单节点
       if (nodes.length==0){
           //用户不存在此菜单节点，可以进行拖拽
           if (treeNodes[0].level>0) {
               var parent_id=treeNodes[0].pId
               var right_treeObj = $.fn.zTree.getZTreeObj('menusTree');
               var right_nodes = right_treeObj.getNodesByParam("id", parent_id, null);  //right总菜单中查找
               var left_nodes = left_treeObj.getNodesByParam("id", parent_id, null);   //left admin菜单中查找
               if (left_nodes.length==0){
                   var nodes=[
                           {id:right_nodes[0].id,name:right_nodes[0].name,pId:null},
                           {id:treeNodes[0].id,name:treeNodes[0].name,pId:right_nodes[0].id}
                   ]
                   left_treeObj.addNodes(null,nodes)
                    return false;
               }else{
                   return targetNode ? targetNode.drop !== false : true;
               }
           } else{
               return targetNode ? targetNode.drop !== false : true;
           }


       }else{
           alert(nodes[0].name+"已存在");
           return false;

       }

    };
    function onDrop(event, treeId, treeNodes, targetNode, moveType){
        $.ajax({
            type:'post',
            url:'/admin2_menus',
            data:{data:treeNodes,admin_id:admin_id},
            success:function(data, response){

            },
            error:function(){

            }
        })
    }

    $(document).ready(function(){
        $.fn.zTree.init($("#menusTree"), setting, zNodes);
        $.fn.zTree.init($("#treeToUser"), setting,adminNodes);

    });
    //-->
</SCRIPT>
 <h1>menus</h1>


 <div class="zTreeDemoBackground left">
   总菜单：
   <ul id="menusTree" class="ztree"></ul>
 </div>

 <div class="pull-left" style="height:360px;line-height:360px;font-size:24px;margin-right:15px;"><span class="glyphicon glyphicon-resize-horizontal"></span></div>
 <div class="right">
   管理员菜单：
   <ul id="treeToUser" class="ztree"></ul>
 </div>
