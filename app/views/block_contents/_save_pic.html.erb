<style>
    input,select{
        /*display: block;*/
        /*margin-top: 1em;*/
    }
    .bar {
        height: 18px;
        background: green;
    }

    #progress1,#progress2 {
        width: 490px;
        background: #f5f5f5;
        /*box-sizing: border-box;*/
    }
</style>
<br>
<br>
<br>
<br>
    <input type="file" name="image" id='fileupload_img' style='visibility:hidden;'>
    <input type=" text" name="image_url"  id='image_path' style='visibility:hidden;' >
    <table class="EditTable" style="margin-top: -80px;">
      <tr class="FormData">
        <td class="CaptionTD">图片标题:</td>  <input type="hidden" id='block_id' name="block_id" value="<%= @page_block.id %>">
        <td class="DataTD"><input type="text" id="title" name='title' class='FormElement ui-widget-content ui-corner-all'></td>
      </tr>
      <tr class="FormData">
        <td class="CaptionTD">内容:</td>
        <td class="DataTD"><input type="text" name='content' id="content" class='FormElement ui-widget-content ui-corner-all'></td>
      </tr>
      <tr class="FormData">
        <td class="CaptionTD">图片路径:</td>
        <td class="DataTD">
          <input id="image_path2" type="text" disabled="disabled" class='FormElement ui-widget-content ui-corner-all' style="display:inline"/><input id="fakebtn1_img" style="display:inline" type="button" value="选择图片文件"/>
         </td>
      </tr>

      <tr class="FormData">
        <td colspan="2">
          <div id="progress2">
            <input type="button" value="保存" onclick="submit_pic()">
          </div>
        </td>
      </tr>
    </table>
<script>

    function getFileName(obj)
    {
        var pos = obj.value.lastIndexOf("/")*1;
        var filepath = obj.value.substring(pos+1);
        var pos2 = filepath.lastIndexOf("\\")*1;
        var filename = filepath.substring(pos2+1);
        $('#video_path').val(filename);
        $('#progress2 .bar').css(
                'width',
                '0%'
        );
    }
    $("#fakebtn1_img").click(function () {
        $("#fileupload_img").click();
    });
    var ChunkCount = 0;
    var stime;
        var url1 = "/edu_videos/upload_image";
        $('#fileupload_img').fileupload({
            autoUpload: true,
            type:'post',
            url: url1,
            dataType: 'json',
            //forceIframeTransport: true,
//            maxChunkSize: 100000000, //100Mb
            fail:function (e, data) {
                console.log(data.errorThrown);
                alert('上传失败！')
            },

            done: function (e, data) {
                alert('上传成功!');
                if (data.result.flag){
                   $('#image_path').val(data.result.url);
                   $('#image_path2').val(data.result.url);
                }
            }
        });
    function submit_pic(){
        $.ajax({
            url: "/block_contents/save_pic_content",
            type: 'post',
            data: { title: $('#title').val(),
                    content:$('#content').val(),
                    url:$('#image_path').val(),
                    block_id:$('#block_id').val()
            },
            async: false,
            success: function (data) {
                $("#rightContent").html(data);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert('图片失败!');
            }
        });
    }

</script>